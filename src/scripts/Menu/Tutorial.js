const tutorialsData = [
	{
		id: 1,
		title: '–û—Å–Ω–æ–≤—ã Ecrous Engine',
		description:
			'–£–∑–Ω–∞–π, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã, —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.',
		videoId: 'xvFZjo5PgG0',
		category: 'beginner',
		level: 'beginner',
		duration: '12:45',
		tags: ['–æ—Å–Ω–æ–≤—ã', '–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å'],
	},
	{
		id: 2,
		title: '–°–∫—Ä–∏–ø—Ç—ã NexLang –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö',
		description: '–í–≤–µ–¥–µ–Ω–∏–µ –≤ NexLang, –±–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∑–∞–ø—É—Å–∫ –∫–æ–¥–∞.',
		videoId: 'ysz5S6PUM-U',
		category: 'beginner',
		level: 'beginner',
		duration: '18:30',
		tags: ['—Å–∫—Ä–∏–ø—Ç—ã', '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ'],
	},
	{
		id: 3,
		title: '–†–∞–±–æ—Ç–∞ —Å–æ —Å–ø—Ä–∞–π—Ç–∞–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏',
		description: '–ö–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã, –∞–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ü–µ–Ω–æ–π.',
		videoId: 'dQw4w9WgXcQ',
		category: 'graphics',
		level: 'beginner',
		duration: '22:15',
		tags: ['–≥—Ä–∞—Ñ–∏–∫–∞', '–∞–Ω–∏–º–∞—Ü–∏—è'],
	},
	{
		id: 4,
		title: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è',
		description: '–¢–µ—Ö–Ω–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.',
		videoId: 'abc123def456',
		category: 'advanced',
		level: 'advanced',
		duration: '35:20',
		tags: ['–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è', '–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å'],
	},
	{
		id: 5,
		title: '–°–æ–∑–¥–∞–Ω–∏–µ UI —Å–∏—Å—Ç–µ–º—ã',
		description:
			'–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.',
		videoId: 'xyz789uvw012',
		category: 'ui',
		level: 'intermediate',
		duration: '28:45',
		tags: ['UI', '–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å'],
	},
	{
		id: 6,
		title: '–§–∏–∑–∏–∫–∞ –∏ –∫–æ–ª–ª–∏–∑–∏–∏',
		description: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –¥–≤–∏–∂–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π.',
		videoId: 'ghi345jkl678',
		category: 'physics',
		level: 'intermediate',
		duration: '25:10',
		tags: ['—Ñ–∏–∑–∏–∫–∞', '–∫–æ–ª–ª–∏–∑–∏–∏'],
	},
]

let currentCategory = 'all'
let currentSort = 'default'

// –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–≤
function openTutorials() {
	const panel = document.getElementById('tutorialsPanel')
	if (!panel) return

	try {
		const overlay = ensureModalOverlay()
		overlay.style.display = 'block'
		setTimeout(() => overlay.classList.add('visible'), 10)
		document.documentElement.style.overflow = 'hidden'
	} catch (e) {}

	panel.style.display = 'flex'
	renderTutorials()
}

// –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å
function closeTutorials() {
	const panel = document.getElementById('tutorialsPanel')
	if (panel) panel.style.display = 'none'

	try {
		const overlay = document.getElementById('modalOverlay')
		if (overlay) {
			overlay.classList.remove('visible')
			setTimeout(() => {
				overlay.style.display = 'none'
			}, 220)
		}
	} catch (e) {}

	document.documentElement.style.overflow = ''
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–≤
function renderTutorials() {
	const container = document.getElementById('tutorialsContent')
	if (!container) return

	// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
	let filteredTutorials = [...tutorialsData]

	if (currentCategory !== 'all') {
		filteredTutorials = filteredTutorials.filter(
			t => t.category === currentCategory
		)
	}

	// –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
	if (currentSort === 'duration') {
		filteredTutorials.sort((a, b) => {
			const timeA = parseDuration(a.duration)
			const timeB = parseDuration(b.duration)
			return timeA - timeB
		})
	} else if (currentSort === 'level') {
		const levelOrder = { beginner: 1, intermediate: 2, advanced: 3 }
		filteredTutorials.sort((a, b) => levelOrder[a.level] - levelOrder[b.level])
	}

	// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
	const categories = {}
	filteredTutorials.forEach(tutorial => {
		if (!categories[tutorial.category]) {
			categories[tutorial.category] = []
		}
		categories[tutorial.category].push(tutorial)
	})

	// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
	if (filteredTutorials.length === 0) {
		container.innerHTML = `
            <div class="empty-state">
                <h3>–¢—É—Ç–æ—Ä–∏–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
            </div>
        `
		return
	}

	let html = ''

	// –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–∑ –≥—Ä—É–ø–ø
	if (currentCategory !== 'all') {
		html += '<div class="tutorials-list">'
		filteredTutorials.forEach(tutorial => {
			html += generateTutorialCard(tutorial)
		})
		html += '</div>'
	} else {
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ –≥—Ä—É–ø–ø–∞–º
		Object.entries(categories).forEach(([category, tutorials]) => {
			const categoryName = getCategoryName(category)
			html += `
                <div class="category-section">
                    <h3 class="category-title">${categoryName}</h3>
                    <div class="tutorials-list">
                        ${tutorials.map(generateTutorialCard).join('')}
                    </div>
                </div>
            `
		})
	}

	container.innerHTML = html
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞
function generateTutorialCard(tutorial) {
	return `
        <div class="tutorial-card" data-video-id="${tutorial.videoId}">
            <div class="tutorial-card-header">
                <span class="tutorial-level ${tutorial.level}">
                    ${getLevelName(tutorial.level)}
                </span>
                <span class="tutorial-duration">
                    ‚è±Ô∏è ${tutorial.duration}
                </span>
            </div>
            <div class="tutorial-thumb-container">
                <img class="tutorial-thumb" 
                     src="https://img.youtube.com/vi/${
												tutorial.videoId
											}/hqdefault.jpg" 
                     alt="${tutorial.title}">
                <div class="play-button"></div>
            </div>
            <div>
                <h3>${tutorial.title}</h3>
                <p>${tutorial.description}</p>
            </div>
            <div class="tutorial-footer">
                <div class="tutorial-actions">
                    <button onclick="openTutorial('${tutorial.videoId}', '${
		tutorial.title
	}')">
                        ‚ñ∂ –û—Ç–∫—Ä—ã—Ç—å
                    </button>
                    <a class="open-new" 
                       href="https://www.youtube.com/watch?v=${
													tutorial.videoId
												}" 
                       target="_blank" 
                       rel="noopener">
                        üîó YouTube
                    </a>
                </div>
            </div>
        </div>
    `
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function getCategoryName(category) {
	const names = {
		beginner: '–î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö',
		graphics: '–ì—Ä–∞—Ñ–∏–∫–∞ –∏ –∞–Ω–∏–º–∞—Ü–∏—è',
		advanced: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ–º—ã',
		ui: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å',
		physics: '–§–∏–∑–∏–∫–∞ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è',
	}
	return names[category] || category
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —É—Ä–æ–≤–Ω—è
function getLevelName(level) {
	const names = {
		beginner: '–ù–∞—á–∞–ª—å–Ω—ã–π',
		intermediate: '–°—Ä–µ–¥–Ω–∏–π',
		advanced: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π',
	}
	return names[level] || level
}

// –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏
function parseDuration(duration) {
	const parts = duration.split(':')
	if (parts.length === 2) {
		return parseInt(parts[0]) * 60 + parseInt(parts[1])
	}
	return 0
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function changeCategory(category) {
	currentCategory = category
	renderTutorials()
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
function changeSort(sort) {
	currentSort = sort
	renderTutorials()
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞
function openTutorial(videoId, title) {
	// –ü–æ—Å—Ç—Ä–æ–∏–º iframe —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º
	var container = document.getElementById('fullNewsContent')
	var embedUrl =
		'https://www.youtube.com/embed/' +
		encodeURIComponent(videoId) +
		'?autoplay=1&rel=0'
	var html = ''
	html +=
		'<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px;">'
	html +=
		'<iframe src="' +
		embedUrl +
		'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>'
	html += '</div>'
	html +=
		'<h3 style="margin-top:20px;color:var(--text);">' + (title || '') + '</h3>'
	html +=
		'<p style="margin-top:10px;"><a href="https://www.youtube.com/watch?v=' +
		encodeURIComponent(videoId) +
		'" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:none;font-weight:600;">‚ñ∂ –û—Ç–∫—Ä—ã—Ç—å –≤ YouTube</a></p>'

	container.innerHTML = html

	// –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –ø–æ–ª–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏ –∏ —Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–≤
	var full = document.getElementById('fullNewsPanel')
	if (full) full.style.display = 'block'
	var tut = document.getElementById('tutorialsPanel')
	if (tut) tut.style.display = 'none'
}

// –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ
function closeFullNews() {
	var full = document.getElementById('fullNewsPanel')
	if (full) full.style.display = 'none'
	var container = document.getElementById('fullNewsContent')
	if (container) container.innerHTML = ''
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function () {
	// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
	const categorySelect = document.getElementById('categoryFilter')
	const sortSelect = document.getElementById('sortFilter')

	if (categorySelect) {
		categorySelect.addEventListener('change', e =>
			changeCategory(e.target.value)
		)
	}

	if (sortSelect) {
		sortSelect.addEventListener('change', e => changeSort(e.target.value))
	}
})
